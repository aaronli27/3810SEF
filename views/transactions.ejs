<html>
<body>
    <h1>Personal Finance Tracker</h1>
    <p>Welcome, <%= user.username %> | <a href="/logout">Logout</a></p>
    
    <!-- Financial Summary (from old dashboard) -->
    <h2>Financial Summary</h2>
    <%
        const totalIncome = transactions.filter(t => t.type === 'Income').reduce((sum, t) => sum + t.amount, 0);
        const totalExpenses = transactions.filter(t => t.type === 'Expense').reduce((sum, t) => sum + t.amount, 0);
        const netBalance = totalIncome - totalExpenses;
    %>
    <p><strong>Income:</strong> $<%= totalIncome.toFixed(2) %></p>
    <p><strong>Expenses:</strong> $<%= totalExpenses.toFixed(2) %></p>
    <p><strong>Balance:</strong> $<%= netBalance.toFixed(2) %></p>
    <p><strong>Total Transactions:</strong> <%= transactions.length %></p>
    
    <hr>
    
    <!-- Filters -->
    <h2>Transactions</h2>
    <form method="GET">
        <select name="type">
            <option value="">All Types</option>
            <option value="Income" <%= filters.type === 'Income' ? 'selected' : '' %>>Income</option>
            <option value="Expense" <%= filters.type === 'Expense' ? 'selected' : '' %>>Expense</option>
        </select>
        <select name="category">
            <option value="">All Categories</option>
            <option value="Salary" <%= filters.category === 'Salary' ? 'selected' : '' %>>Salary</option>
            <option value="Food" <%= filters.category === 'Food' ? 'selected' : '' %>>Food</option>
            <option value="Transport" <%= filters.category === 'Transport' ? 'selected' : '' %>>Transport</option>
            <option value="Entertainment" <%= filters.category === 'Entertainment' ? 'selected' : '' %>>Entertainment</option>
        </select>
        <input name="search" placeholder="Search" value="<%= filters.search || '' %>">
        <button>Filter</button>
        <a href="/transactions">Clear</a>
    </form>
    
    <p><a href="/transactions/create">+ Add New Transaction</a></p>
    
    <!-- Transactions Table -->
    <% if (transactions.length === 0) { %>
        <p>No transactions found.</p>
    <% } else { %>
        <table border="1">
            <tr>
                <th>Date</th><th>Title</th><th>Amount</th><th>Type</th><th>Category</th><th>Actions</th>
            </tr>
            <% transactions.forEach(t => { %>
            <tr>
                <td><%= new Date(t.date).toLocaleDateString() %></td>
                <td><%= t.title %></td>
                <td>$<%= t.amount.toFixed(2) %></td>
                <td><%= t.type %></td>
                <td><%= t.category %></td>
                <td>
                    <a href="/transactions/details?_id=<%= t._id %>">View</a>
                    <a href="/transactions/edit?_id=<%= t._id %>">Edit</a>
                    <form action="/transactions/delete" method="POST" style="display:inline">
                        <input type="hidden" name="_id" value="<%= t._id %>">
                        <button onclick="return confirm('Delete?')">Delete</button>
                    </form>
                </td>
            </tr>
            <% }); %>
        </table>
    <% } %>
</body>
</html>
